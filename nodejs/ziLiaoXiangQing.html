<!DOCTYPE html>
<html lang="en">
	<head>
	    <meta charset="UTF-8">
	    <title>资料详情</title>
		<!-- <script src="routes/index.js" type="text/javascript" charset="utf-8"></script> -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.dev.js" type="text/javascript" charset="utf-8"></script>
	    <script type="text/javascript" src="jquery.js"></script>
		<link rel="stylesheet" type="text/css" href="css/record.css"/>
		<link rel="stylesheet" type="text/css" href="css/ziLiaoXiangQing.css" />
		<script>
			
			!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=window;t["default"]=i.vl=function(e,t){var n=e||100,r=t||750,a=i.document,d=navigator.userAgent,o=d.match(/Android[\S\s]+AppleWebkit\/(\d{3})/i),l=d.match(/U3\/((\d+|\.){5,})/i),s=l&&parseInt(l[1].split(".").join(""),10)>=80,u=a.documentElement,c=1;if(o&&o[1]>534||s){u.style.fontSize=n+"px";var p=a.createElement("div");p.setAttribute("style","width: 1rem;display:none"),u.appendChild(p);var m=i.getComputedStyle(p).width;if(u.removeChild(p),m!==u.style.fontSize){var v=parseInt(m,10);c=100/v}}var f=a.querySelector('meta[name="viewport"]');f||(f=a.createElement("meta"),f.setAttribute("name","viewport"),a.head.appendChild(f)),f.setAttribute("content","width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1");var h=function(){u.style.fontSize=n/r*u.clientWidth*c+"px"};h(),i.addEventListener("resize",h)},e.exports=t["default"]}]);
			// 设置基础字体大小及字体缩放比例
			vl(100, 750);
		</script>
	</head>
	<body>
	    <div class="denglu" v-show="showFlag">
			<div class="searchBox">
				<div class="home-search">
					<font class="xiangmu-left"></font>
					<span>详细资料</span>
					<!--<div class="fanhui-right">
						<div>
							<font>注册</font>
						</div>
					</div>-->
					<font class="xiangmu-rigth"></font>
					<ul>
						<li>移除好友</li>
						<!--<li>已注册人员</li>
						<li>发起群聊</li>
						<li>添加好友</li>
						<li>扫一扫</li>-->
					</ul>
				</div>
			</div>
			<div class="contents">
				<div class="logo">
					<div class="fankiu">
						<div class="content-food border-bottom">
							<div class="imgas">
								<p>
									<img class="border" src="" alt="" />
								</p>
							</div>
							<div class="texts">
								<span class="first"><i>名字</i><a></a></span>
								<span class="lalst lalst_center">聊聊号：<a>xxxx</a></span>
								<span class="lalst lalst_name">昵称：<a></a></span>
							</div>
						</div>
					</div>
				</div>
				<div class="denglu-text">
					<div class="sheZhi denglu_sheZhi">
						设置备注
					</div>
					<div class="beiZhu">
						<span>电话号码：</span><font></font>
					</div>
				</div>
				<div class="denglu-text ziZhu">
					<div class="diQu">
						<span>地区：</span><font>未设置</font>
					</div>
					<div class="xiangCe">
						<span>个人相册</span><font></font>
					</div>
				</div>
				<div class="denglu-food denglu-food1">
					<span>发送消息</span>
				</div>
				<div class="denglu-food friends" style='display:none;'>
					<span>添加好友</span>
				</div>
				<div class="tanChuang">
					<div id="tanChuang_top"></div>
					<div class="tanChuang_cont">
						<div class="sheZhi sheZhiFirst">
							<span>备注名：</span><input placeholder="请输入备注名" type="text" class="ferst mint-field-core"/>
						</div>
						<div class="sheZhi sheZhiLste">
							<span>电话号码：</span><input placeholder="请输入电话号码" type="number" class="last mint-field-core"/>
						</div>
					</div>
					<div class="tanChuang_food tanChuang_first">
						<span>保&nbsp;&nbsp;存</span>
					</div>
					<div class="tanChuang_food tanChuang_last">
						<span>取&nbsp;&nbsp;消</span>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="jquery.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		var lists = {},socket = io.connect('http://127.0.0.1:8080'),
			image = {},nickName = '',
			fromType = window.localStorage.getItem('fromType'),
			sexImage = window.localStorage.getItem('sex'),
			Youimg = null,types = window.localStorage.getItem('type'),
			toChatName = null,myName = null,addFriend = '';
			toNames = window.localStorage.getItem('toNames'),
			toChatName_groupChatAll = window.localStorage.getItem('toChatName_groupChatAll');
			if(types == 'groupChat'){
				toChatName = window.localStorage.getItem('toChatName_groupChat');
				myName = window.localStorage.getItem('name');
				Youimg = window.localStorage.getItem('headPortrait_groupChat');
				// toNames = window.localStorage.getItem('groupOwner');
			}else{
				toChatName = window.localStorage.getItem('toChatName');
				myName = window.localStorage.getItem('name');
				Youimg = window.localStorage.getItem('headPortrait');
				// toNames = window.localStorage.getItem('toNames');
			}
			
		$('.texts .first i').text(toNames);
		$('.lalst_name a').text(toNames);
		$('.fankiu .imgas img')[0].src = Youimg;
		if(sexImage !== 'Sir'){
			$('.texts .first a').attr({'class':'image'});
		}
		$('.beiZhu').on('click',function(){
			window.location.href='tel:'+window.localStorage.getItem('remarksNuber')
		})
		$('.xiangmu-left').on('click',function(){
			if(toChatName_groupChatAll){
				window.location.href = 'suoYouChengYuan.html';
				window.localStorage.removeItem('toChatName_groupChatAll');
			}else if(fromType == 'All'){
				window.location.href = 'liaoTianLieBiao.html';
			}else{
				window.location.href = 'liaoTianShi.html';
			}
		})
		//资料详情
		$.ajax({
			type:'post',
			url:'http://127.0.0.1:8080/remarks1',
			data:{'toChatName':toChatName,'myName':myName,'type': types},
			success:function(data){
				console.log(data);
				if(data.code === 200){
					window.localStorage.removeItem('remarksName');
					window.localStorage.removeItem('remarksNuber');
					$('.lalst_center a').text(data.LLNumber);
					if(data.sex !== 'Sir'){
						$('.texts .first a').attr({'class':'image'});
					}else{
						$('.texts .first a').attr({'class':''});
					}
					if(data.remarksNameNo == 'no'){
						$('.texts .first i').text(data.remarksName);
						$('.lalst_name a').text(data.remarksName);
						window.localStorage.setItem('toNames',data.remarksName);
						nickName = data.remarksName;
					}else{
						$('.texts .first i').text(data.remarksName);
						$('.lalst_name a').text(data.remarksNameNick);
						window.localStorage.setItem('toNames',data.remarksName);
						nickName = data.remarksName;
					}
					if(data.remarksNuber){
						$('.beiZhu').show().children('font').text(data.remarksNuber);
						window.localStorage.setItem('remarksNuber',data.remarksNuber);
					}else{
						$('.beiZhu').hide();
						window.localStorage.setItem('remarksNuber','');
					}
					if(data.myRegion){
						$('.diQu font').text(data.myRegion);
					}else{
						$('.diQu font').text('未设置');
					}
					if(data.friend == 'no'){
						$('.lalst_name a').text(data.remarksName);
						addFriend = data.remarksName;
						$('.denglu_sheZhi').hide();
						$('.friends').show();
						$('.denglu-food1').hide();
						$('.xiangmu-rigth').hide();
					}else{
						$('.denglu_sheZhi').show();
						$('.denglu-food1').show();
						$('.xiangmu-rigth').show();
					}
				}else if(data.code === 2001){
					//用户不存在请先注册
					alert(data.msg);
				}
			},
			error:function(){
				console.log('error');
			}
		})
		//保存
		$('.tanChuang_first').on('click',function(){
			var remarksName = $('.ferst')[0].value,remarksNuber = $('.last')[0].value;
			lists.toChatName = toChatName;
			lists.remarksName = remarksName;
			lists.remarksNuber = remarksNuber
			lists.myName = myName;
			if(remarksName == '' && remarksNuber == ''){
				alert('没有要保存的信息！请填写...');
				return;
			}
			$.ajax({
				type:'post',
				url:'http://127.0.0.1:8080/remarks',
				data:lists,
				success:function(data){
					console.log(data);
					if(data.code === 1001){
						//"用户名或密码错误"
						alert(data.msg);
					}else if(data.code === 200){
						$('.ferst')[0].value = '';
						$('.last')[0].value = '';
						$('.tanChuang').hide();
						$('.home-search span').text('详细资料');
						if(data.remarksName){
							$('.texts .first i').text(data.remarksName);
							window.localStorage.setItem('toNames',data.remarksName);
//							window.localStorage.setItem('nickName',data.remarksName);
						}
						if(data.remarksNuber){
							$('.beiZhu').show().children('font').text(data.remarksNuber);
						}
						alert(data.msg);
					}else if(data.code === 2001){
						//用户不存在请先注册
						alert(data.msg);
					}
				},
				error:function(){
					console.log('error');
				}
			})
		})
		$('.tanChuang_last').on('click',function(){
			$('.tanChuang').hide();
			$('.home-search span').text('详细资料');
		})
		$('.denglu_sheZhi').on('click',function(){
			var gerRemarksName = window.localStorage.getItem('toNames'),
				getEemarksNuber = window.localStorage.getItem('remarksNuber');
			$('.tanChuang').show();
			$('.home-search span').text('添加备注');
			if(gerRemarksName && gerRemarksName != 'no'){
				$('.ferst')[0].value = gerRemarksName;
			}
			if(getEemarksNuber){
				$('.last')[0].value = getEemarksNuber;
			}
		})
		$('.denglu-food1').on('click',function(){
			window.localStorage.setItem('nickName',nickName);
			window.localStorage.setItem('headPortrait',Youimg);
			window.localStorage.setItem('type','chat');
			window.localStorage.setItem('toChatName',toChatName);
			window.location.href = 'liaoTianShi.html';
		});
		$('.friends').on('click',function(){
			console.log('添加好友')
			//添加好友；
			$.ajax({
				type:'post',
				url:'http://127.0.0.1:8080/post4',
				data:{
					'addName':addFriend, 'fromNumber':myName,'addNumber':toChatName,
				},
				success:function(data){
					console.log(data);
					if(data.code == 200 ){
						//向对方发送添加好友验证消息
						socket.emit('clientmessage', {
							fromName: myName,
							toName: toChatName,
							text: {'friend':'no','addName':addFriend}
						})
						window.location.href = 'liaoTianLieBiao.html';
					}else{
						alert(data.msg);
					}
				},
				error:function(){
					console.log('error');
				}
			})
		});
		$(document).on('click',function(e){
//				console.log(e)
			if (!$(e.target).closest(".xiangmu-rigth,.xiangmu-rigth").length) {
		        $('.home-search ul').hide().removeAttr('class');
		   	}
		})
		$('.xiangmu-rigth').on('click',function(){
			if($('.home-search ul').attr('class')){
				$('.home-search ul').hide().removeAttr('class');
			}else{
				$('.home-search ul').show().attr({'class':'show'});
			}
		})
		$('.home-search ul li').on('click',function(){
			if(this.innerText == '移除好友'){
				console.log(this.innerText);
				var list = {
					'removeName': window.localStorage.getItem('toNames'),
					'fromNumber': myName,
					'removeNumber': toChatName
				}
				$('.home-search ul').hide().removeAttr('class');
				//移除好友；
				$.ajax({
					type:'post',
					url:'http://127.0.0.1:8080/post4_1',
					data:list,
					success:function(data){
						console.log(data);
						if(data.code == 200 ){
							//向对方发送添加好友验证消息
							socket.emit('clientmessage', {
								fromName: myName,
								toName: list.removeNumber,
								text: '移除好友'
							})
							alert(data.msg);
							window.location.href = 'liaoTianLieBiao.html';
						}else{
							alert(data.msg);
						}
					},
					error:function(){
						console.log('error');
					}
				})
			}
		});
	</script>
</html>