<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>聊天室</title>
    <!-- <script src="routes/index.js" type="text/javascript" charset="utf-8"></script> -->
    <link rel="stylesheet" type="text/css" href="css/record.css" />
    <link rel="stylesheet" type="text/css" href="css/liaoTianShi.css" />
  </head>
  <body>
    <div v-show="tucaoShow" class="yijian">
      <div class="searchBox">
        <div class="home-search">
          <span class="xiangmu-left"></span>
          <span class="toNames"></span>
          <font class="xiangmu-rigth"></font>
          <ul>
            <li>查看所有成员</li>
            <li>添加成员</li>
            <li class="groupOwner_log">退出本群</li>
            <li class="groupOwner" style="display: none">转让退出本群</li>
            <li class="groupOwner" style="display: none">移除本群</li>
          </ul>
          <!-- <div class="fanhui-right">
						<div class="tousu" @click.stop="tousuBlock()">
							<span>投诉</span>
						</div>
					</div> -->
        </div>
      </div>
      <div class="content-text" id="contentTexte">
        <div class="box boxTexte" ref="boxTexte" id="box"></div>
        <div class="shuru" id="shuru">
          <ul>
            <li>
              <div class="voice"></div>
              <div class="voice_botten">
                <div class="voice_botten_text">按住&nbsp;说话</div>
              </div>
              <p
                contenteditable="true"
                placeholder="请详输入内容..."
                id="texts"
                class="mint-field-core"
              ></p>
              <!-- <textarea placeholder="请详输入内容..." id="texts" class="mint-field-core"></textarea> -->
              <div class="expressions"></div>
              <div class="fasong"><span>发送</span><font></font></div>
            </li>
          </ul>
          <div class="expression">
            <div class="expressionList"></div>
          </div>
        </div>
      </div>
      <div class="tanCeng">
        <div class="tanCeng_cont">
          <div class="tanCeng_cont_top">请选择转让群主</div>
          <div class="tanCeng_cont_box">
            <div class="tanCeng_cont_box_tex">
              <!--<div class="content-food border-bottom">
								<label><div><div class="imgas">
									<p>
										<img class="border" src="'+data.body[i].headPortrait+'" alt="" />
									</p>
								</div>
									<span class="first">'+nickName+'</span>
									<input name="Fruit" type="radio" value="" id= "checkboxs"/></div></label>
							</div>-->
            </div>
          </div>
          <div class="tanCeng_cont_bottom">
            <font>确定</font>
            <span>取消</span>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script src="index.js" type="text/javascript" charset="utf-8"></script>
  <!-- <script
    src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.dev.js"
    type="text/javascript"
    charset="utf-8"
  ></script> -->
  <script
    src="socket.io.dev.js"
    type="text/javascript"
    charset="utf-8"
  ></script>
  <script src="jquery.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript">
    var leave = document.getElementById('leaveBtn');
    var socket = io.connect('http://127.0.0.1:8080'),
      lists = {},
      textName = null,
      textName_1 = null,
      image = {},
      toId = '',
      toNameId = '',
      remarksNuberL = window.localStorage.getItem('remarksNuber');
    (textNameOld = window.localStorage.getItem('textName')),
      (Myimg = window.localStorage.getItem('myHeadPortrait')),
      (Youimg = window.localStorage.getItem('headPortrait')),
      (nickNameTop = window.localStorage.getItem('nickName')),
      (chatType = window.localStorage.getItem('type')),
      (myLocName = window.localStorage.getItem('name')),
      (locMyName = window.localStorage.getItem('myName')),
      (groupOwner = window.localStorage.getItem('groupOwner')),
      (imgId = window.localStorage.getItem('imgId')),
      (imgIdLoc = JSON.parse(window.localStorage.getItem('imgIdLoc')));

    var page = 1,
      pageSize = 10,
      dateTimes = '',
      heights = '',
      heights1 = '';
    expressionList = [
      '😀',
      '😀',
      '😃',
      '😄',
      '😁',
      '😆',
      '😅',
      '😂',
      '😊',
      '😇',
      '🙂',
      '🙃',
      '😉',
      '😌',
      '😍',
      '😘',
      '😗',
      '😙',
      '😚',
      '😋',
      '😜',
      '😝',
      '😛',
      '🤑',
      '🤗',
      '🤓',
      '😎',
      '😏',
      '😒',
      '😞',
      '😔',
      '😟',
      '😕',
      '🙁',
      '😣',
      '😖',
      '😫',
      '😩',
      '😤',
      '😠',
      '😡',
      '😶',
      '😐',
      '😑',
      '😯',
      '😦',
      '😧',
      '😮',
      '😲',
      '😵',
      '😳',
      '😱',
      '😨',
      '😰',
      '😢',
      '😥',
      '😭',
      '😓',
      '😪',
      '😴',
      '🙄',
      '🤔',
      '😬',
      '🤐',
      '😷',
      '🤒',
      '🤕',
      '😈',
      '👿',
      '👹',
      '👺',
      '💩',
      '👻',
      '💀',
      '👽',
      '👾',
      '🤖',
      '🎃',
      '😺',
      '😸',
      '😹',
      '😻',
      '😼',
      '😽',
      '🙀',
      '😿',
      '😾',
      '👐',
      '🙌',
      '👏',
      '🙏',
      '👍',
      '👎',
      '👊',
      '✊',
      '🤘',
      '👌',
      '👈',
      '👉',
      '👆',
      '👇',
      '✋',
      '🖐',
      '🖖',
      '👋',
      '💪',
      '🖕',
      '💅',
      '🖖',
      '💄',
      '💋',
      '👄',
      '👅',
      '👂',
      '👃',
      '👁',
      '👀',
    ];
    (function () {
      var textList = '';
      var spans = '';
      for (var i = 1; i < expressionList.length; i++) {
        spans += '<span>' + expressionList[i] + '</span>';
        if (i % 8 == 0 || i == expressionList.length - 1) {
          textList += '<div class="expression_box">' + spans + '</div>';
          spans = '';
        }
      }
      $('.expressionList').html(textList);
    })();
    if (groupOwner == myLocName) {
      $('.groupOwner').show();
      $('.groupOwner_log').hide();
    }
    if (chatType == 'chat') {
      console.log('屏蔽此人');
      $('.xiangmu-rigth').attr({ class: 'xiangmu-rigth rigth_background' });
      if (
        remarksNuberL == 'undefined' ||
        remarksNuberL == '' ||
        remarksNuberL == 'no'
      ) {
        $('.xiangmu-rigth').hide();
        // window.location.href = "tel:" + remarksNuberL;
      } else {
        $('.xiangmu-rigth').attr({ class: 'xiangmu-rigth dianhua' });
      }
    }
    function Default() {
      (this.props = function () {
        this.tupian();
        this.getList('types');
        this.socketIo();
        this.prent = $('.boxTexte')[0];
      }),
        (this.toChat = function (text, value) {
          if (value == myLocName) {
            return;
          }
          console.log(text, value);
          toNameId = text;
          toId = value;
        }),
        (this.tupian = function () {
          heights = $('#shuru').height();
          heights1 = $('#shuru').height();
          console.log(heights);
          if (nickNameTop != 'no' && chatType == 'chat') {
            $('.yijian .toNames').text(nickNameTop);
          } else if (chatType == 'groupChat') {
            $('.yijian .toNames').html(
              '<i class="first">' +
                nickNameTop +
                '</i><i class="last">（' +
                window.localStorage.getItem('localNumber') +
                '）</i>'
            );
          } else {
            $('.yijian .toNames').text(window.localStorage.getItem('toNames'));
          }
          $('.xiangmu-left').on('click', function () {
            window.location.href = 'liaoTianLieBiao.html';
          });
          $('.fasong font').on('click', function () {
            console.log('添加');
          });
          $('.tanCeng_cont_bottom font').on('click', function () {
            if (toId == '') {
              return;
            }
            console.log('确定');
            for (var i = 0; i < imgIdLoc.length; i++) {
              if (imgIdLoc[i].name != myLocName) {
                textName += imgIdLoc[i].name * 1;
              }
              textName_1 += imgIdLoc[i].name * 1;
            }
            var list = {
              nickName: [locMyName],
              name: [{ name: myLocName, newsNumber: 0 }],
              imgId: [imgId],
              text:
                '【' +
                locMyName +
                '】已退出将本群转让给' +
                '【' +
                toNameId +
                '】为本群群主',
              buildingGroupName: nickNameTop,
              moveName: 'yes',
              Transfer: toId,
              textName: textName.toString(),
            };
            list = JSON.stringify(list);
            console.log(list, textName, textName_1, nickNameTop);
            //转让本群
            $.ajax({
              type: 'post',
              url: 'http://127.0.0.1:8080/buildingGroup_add',
              data: { data: list },
              success: function (data) {
                console.log(data);
                if (data.code == 200) {
                  alert(data.msg);
                  socket.emit('clientmessage', {
                    fromName: myLocName,
                    toName: [{ name: myLocName, newsNumber: 0 }],
                    text_first: 'yes',
                    text:
                      '【' +
                      locMyName +
                      '】已退出将本群转让给' +
                      '【' +
                      toNameId +
                      '】为本群群主',
                    nickName: nickNameTop,
                    textName: nickNameTop + textName,
                    textName_1: nickNameTop + textNameOld,
                    Transfer: toId,
                  });
                  window.location.href = 'liaoTianLieBiao.html';
                }
              },
              error: function () {
                console.log('error');
              },
            });
          });
          $('.tanCeng_cont_bottom span').on('click', function () {
            console.log('取消');
            toId = '';
            $('.tanCeng').hide();
          });
          $(document).on('click', function (e) {
            //				console.log(e)
            if (
              !$(e.target).closest('.xiangmu-rigth,.groupOwner,.tanCeng').length
            ) {
              $('.home-search ul').hide().removeAttr('class');
            }
          });
          $('.xiangmu-rigth').on('click', function () {
            if (chatType == 'chat') {
              console.log('屏蔽此人');
              window.location.href = 'tel:' + remarksNuberL;
              return;
            }
            if ($('.home-search ul').attr('class')) {
              $('.home-search ul').hide().removeAttr('class');
            } else {
              $('.home-search ul').show().attr({ class: 'show' });
            }
          });
          $('.home-search ul li').on('click', function () {
            if (this.innerText == '查看所有成员') {
              console.log(this.innerText);
              window.location.href = 'suoYouChengYuan.html';
              $('.box_list').hide();
              $('.box_friend').show();
              $('.home-search ul').hide().removeAttr('class');
            } else if (this.innerText == '添加成员') {
              console.log(this.innerText);
              $('.box_friend').hide();
              $('.box_list').show();
              $('.home-search ul').hide().removeAttr('class');
              window.location.href = 'tianJiaChengYuan.html';
            } else if (this.innerText == '退出本群') {
              console.log(this.innerText);
              $('.box_friend').hide();
              $('.box_list').show();
              $('.home-search ul').hide().removeAttr('class');
              for (var i = 0; i < imgIdLoc.length; i++) {
                if (imgIdLoc[i].name != myLocName) {
                  textName += imgIdLoc[i].name * 1;
                }
                textName_1 += imgIdLoc[i].name * 1;
              }
              var list = {
                nickName: [locMyName],
                name: [{ name: myLocName, newsNumber: 0 }],
                imgId: [imgId],
                text: '【' + locMyName + '】已退出本群',
                buildingGroupName: nickNameTop,
                moveName: 'yes',
                textName: textName.toString(),
              };
              list = JSON.stringify(list);
              console.log(
                list,
                nickNameTop + textName,
                nickNameTop + textName_1
              );
              //退出本群
              $.ajax({
                type: 'post',
                url: 'http://127.0.0.1:8080/buildingGroup_add',
                data: { data: list },
                success: function (data) {
                  console.log(data);
                  if (data.code == 200) {
                    alert(data.msg);
                    socket.emit('clientmessage', {
                      fromName: myLocName,
                      toName: [{ name: myLocName, newsNumber: 0 }],
                      text_first: 'yes',
                      text: '【' + locMyName + '】已退出本群',
                      nickName: nickNameTop,
                      textName: nickNameTop + textName,
                      textName_1: nickNameTop + textNameOld,
                    });
                    window.location.href = 'liaoTianLieBiao.html';
                  }
                },
                error: function () {
                  console.log('error');
                },
              });
            } else if (this.innerText == '转让退出本群') {
              console.log(this.innerText);
              $('.tanCeng').show();
              var monList = '',
                name_list = '',
                iconName_list = '';
              //						$('.box_friend').hide();
              //						$('.box_list').show();
              //						$('.home-search ul').hide().removeAttr('class');
              //						window.location.href = '聊天列表.html';
              for (var i = 0; i < imgIdLoc.length; i++) {
                var disabled = null;
                if (imgIdLoc[i].name == myLocName) {
                  disabled = 'disabled="disabled"';
                }
                name_list = "'" + imgIdLoc[i].nickName + "'";
                iconName_list = "'" + imgIdLoc[i].name + "'";
                monList +=
                  '<div class="content-food border-bottom" onClick="that.toChat(' +
                  name_list +
                  ',' +
                  iconName_list +
                  ')">' +
                  '<label><div><div class="imgas">' +
                  '<p>' +
                  '<img class="border" src="' +
                  imgIdLoc[i].classIcon +
                  '" alt="" />' +
                  '</p>' +
                  '</div>' +
                  '<span class="first">' +
                  imgIdLoc[i].nickName +
                  '</span>' +
                  '<input ' +
                  disabled +
                  ' name="Fruit" type="radio" value="' +
                  imgIdLoc[i].name +
                  '" id= "checkboxs"/></div></label>' +
                  '</div>';
              }
              $('.tanCeng_cont_box_tex').html(monList);
            } else if (this.innerText == '移除本群') {
              console.log(this.innerText);
              //移除本群;
              $.ajax({
                type: 'post',
                url: 'http://127.0.0.1:8080/buildingGroup_move',
                data: { nickName: nickNameTop },
                success: function (data) {
                  console.log(data);
                  if (data.code == 200) {
                    alert(data.msg);
                    // objs_name.splice(objs_name.length-1,1);
                    socket.emit('clientmessage', {
                      fromName: myLocName,
                      toName: [],
                      text_last: 'yes',
                      text: nickNameTop + '已将本群移除...',
                      type: 'groupChat',
                    });
                    $('.box_friend').hide();
                    $('.box_list').show();
                    $('.home-search ul').hide().removeAttr('class');
                    window.location.href = 'liaoTianLieBiao.html';
                  }
                },
                error: function () {
                  console.log('error');
                },
              });
            }
          });

          $('#texts').bind('input propertychange click', function () {
            // console.log('kkkkkkk',$("#texts")[0].innerText);
            if ($('#texts')[0].innerText == '') {
              $('.fasong').css({ background: 'none' }).find('span').hide();
              $('.fasong font').show();
            } else {
              $('.fasong font').hide();
              $('.fasong').css({ background: '#ff7a59' }).find('span').show();
            }
            if ($('.expression').attr('show')) {
              console.log('kkkkkkk', $('#texts').val);
              $('.expressions').attr({ class: 'expressions' });
              $('.expression').hide().removeAttr('show');
            }
            var height = $('#shuru').height();
            // console.log('kkkkkkk'+height);
            if (height > heights + 6) {
              heights = height;
              $('#box').css({ 'padding-bottom': height + 12 + 'px' });
              $('#shuru ul').css({ 'padding-top': '0' });
            } else {
              if (height < heights1) {
                $('#shuru ul').css({ 'padding-top': '0.14rem' });
                heights1 = $('#shuru').height();
                heights = $('#shuru').height();
              }
              $('#box').css({ 'padding-bottom': height + 12 + 'px' });
            }
            that.scrollHeights();
          });
          //点击语音
          $('.voice').on('click', function () {
            if ($('.voice').attr('show')) {
              $('.voice').attr({ class: 'voice' }).removeAttr('show');
              $('.voice_botten').hide();
              $('.mint-field-core').show();
            } else {
              $('.voice').attr({ class: 'voice voice_image', show: 'show' });
              $('.voice_botten').show();
              $('.mint-field-core').hide();
              $('.expressions').attr({ class: 'expressions' });
              $('.expression').hide().removeAttr('show');
              $('#box').css({
                'padding-bottom': $('#shuru').height() + 12 + 'px',
              });
            }
          });
          //点击表情包
          $('.expressions').on('click', function () {
            $('#texts').focus();
            // $( '#texts' ).blur();失去焦点
            if ($('.expression').attr('show')) {
              console.log('kkkkkkk');
              $('.expressions').attr({ class: 'expressions' });
              $('.expression').hide().removeAttr('show');
              $('#box').css({
                'padding-bottom': $('#shuru').height() + 12 + 'px',
              });
              $('.voice_botten').hide();
              $('.mint-field-core').show();
            } else {
              $('.expression').show().attr({ show: 'show' });
              $('.expressions').attr({ class: 'expressions expres_image' });
              $('#box').css({
                'padding-bottom': $('#shuru').height() + 12 + 'px',
              });
              $('.voice_botten').hide();
              $('.mint-field-core').show();
              $('.voice').attr({ class: 'voice' }).removeAttr('show');
              // $('.voice').attr({"class":'voice voice_image',"show":'show'});
              that.scrollHeights();
            }
          });
          //点击某个表情给输入赋值
          $('.expressionList span').on('click', function () {
            console.log(this.innerHTML);
            // $('#texts')[0].innerText += this.innerText;
            // $( '#texts' ).focus();
            $('.fasong font').hide();
            $('.fasong').css({ background: '#ff7a59' }).find('span').show();
            that.toEnd(this.innerHTML);
            that.scrollHeights();
          });
        }),
        (this.toEnd = function (text) {
          var obj = document.getElementById('texts');
          var range, node;
          if (!obj.hasfocus) {
            obj.focus();
          }
          if (window.getSelection && window.getSelection().getRangeAt) {
            range = window.getSelection().getRangeAt(0);
            range.collapse(false);
            node = range.createContextualFragment(text);
            var c = node.lastChild;
            range.insertNode(node);
            if (c) {
              range.setEndAfter(c);
              range.setStartAfter(c);
            }
            var j = window.getSelection();
            j.removeAllRanges();
            j.addRange(range);
          } else if (document.selection && document.selection.createRange) {
            document.selection.createRange().pasteHTML(text);
          }
          $('#box').css({ 'padding-bottom': $('#shuru').height() + 12 + 'px' });
        });
      //过去式记录格式为：几时几分、超过24小时显示几月几日
      (this.numToTime = function (num) {
        if (num == '') {
          return;
        }
        var newNum = new Date().getTime(),
          time = new Date(num).toLocaleString(),
          date = new Date(new Date()),
          year,
          mouth,
          day,
          h,
          m,
          newTime = new Date(newNum).toLocaleString(),
          week = {
            0: '日',
            6: '一',
            5: '二',
            4: '三',
            3: '四',
            2: '五',
            1: '六',
          },
          getDays = new Date().getDate() * 1;
        //        console.log(newNum)
        time = time.replace(/\d+[\/\-]/, function (text) {
          year = text.match(/\d+/)[0];
          return '';
        });
        time = time.replace(/\d+[\/\-]/, function (text) {
          mouth = text.match(/\d+/)[0];
          return '';
        });
        time = time.replace(/\d+/, function (text) {
          day = text.match(/\d+/)[0];
          return '';
        });
        time = time.replace(/\d+/, function (text) {
          h = text.match(/\d+/)[0];
          return '';
        });
        time = time.replace(/\d+/, function (text) {
          m = text.match(/\d+/)[0];
          return '';
        });
        num = (newNum - num) / 1000;
        function getHours() {
          if (/上午/.test(time)) {
            if (h == 12 || h < 5) {
              if (h == 12) {
                return '凌晨00' + ':' + m;
              } else {
                return '凌晨0' + h.toString() + ':' + m;
              }
            } else if (h == 5) {
              return '清晨0' + h.toString() + ':' + m;
            } else if (h > 5 && h < 11) {
              if (h == 10) {
                return '早上' + h.toString() + ':' + m;
              } else {
                return '早上0' + h.toString() + ':' + m;
              }
            } else if (h > 10 && h < 12) {
              return '中午' + h.toString() + ':' + m;
            }
          } else {
            if (h == 12 || h < 1) {
              if (h == 12) {
                return '中午' + h.toString() + ':' + m;
              } else {
                return '中午' + (h * 1 + 12).toString() + ':' + m;
              }
            } else if (h > 0 && h < 7) {
              return '下午' + (h * 1 + 12).toString() + ':' + m;
            } else if (h > 6 && h < 12) {
              return '晚上' + (h * 1 + 12).toString() + ':' + m;
            }
          }
        }
        //        console.log('ooooooo====',date.getDay());
        if (getDays == day * 1) {
          return getHours();
        }
        if (getDays - day * 1 == 1) {
          return '昨天&nbsp' + getHours();
        } else if (getDays - day * 1 > 1 && getDays - day * 1 < day * 1) {
          // return '周' + week[getDays - day*1 + ""] + '&nbsp' + getHours();
        }
        if (year === newTime.match(/\d+/)[0]) {
          return mouth + '月' + day + '日&nbsp' + getHours();
        } else {
          return year + '年' + mouth + '月' + day + '日&nbsp' + getHours();
        }
      }),
        (this.tousuoGo = function (times, text) {
          //提示投诉信息内容按钮
          if (text == 'no') {
            return;
          }
          this.tousuoContent = '投诉成功！';
          var tiShi = document.createElement('div'); //提示信息内容
          var textCont = document.createElement('font');
          textCont.innerHTML = times; //后台获取信息插入
          tiShi.appendChild(textCont);
          this.prent.appendChild(tiShi);
          textCont.style.color = '#fff';
          textCont.style.lineHeight = '0.44rem';
          textCont.style.fontSize = '0.32rem';
          textCont.style.background = '#cfced2';
          textCont.style.display = 'inline-block';
          textCont.style.padding = '0 0.12rem';
          textCont.style.borderRadius = '0.08rem';
          textCont.style.wordWrap = 'break-word';
          tiShi.style.fontSize = 0;
          tiShi.style.width = '82%';
          tiShi.style.margin = '0 auto';
          tiShi.style.padding = '0.2rem 0';
          tiShi.style.textAlign = 'center';
        }),
        (this.ChushiHuaTimes = function () {
          //初始化时间函数
          var times = new Date(); //实例化日期对象；
          var myMonth = times.getMonth(); //当前的月份；
          myMonth = myMonth + 1; //当前的月份；
          var myDate = times.getDate(); //当前的日期；
          var myHours = times.getHours(); //当前的小时；
          var newNum = times.getTime(),
            time = new Date(newNum).toLocaleString();
          if (/上午/.test(time)) {
            if (myHours == 12 || myHours < 5) {
              if (myHours == 12) {
                myHours = '凌晨00';
              } else {
                myHours = '凌晨0' + myHours.toString();
              }
            } else if (myHours == 5) {
              myHours = '清晨0' + myHours.toString();
            } else if (myHours > 5 && myHours < 11) {
              if (myHours == 10) {
                myHours = '早上' + myHours.toString();
              } else {
                myHours = '早上0' + myHours.toString();
              }
            } else if (myHours > 10 && myHours < 12) {
              myHours = '中午' + myHours.toString();
            }
          } else {
            console.log(myHours);
            if (myHours == 12 || myHours < 13) {
              if (myHours == 12) {
                myHours = '中午' + myHours.toString();
              } else {
                myHours = '中午' + myHours.toString();
              }
            } else if (myHours > 12 && myHours < 19) {
              myHours = '下午' + myHours.toString();
            } else if (myHours > 18 || myHours == 0) {
              myHours = '晚上' + myHours.toString();
            }
          }
          if (times.getMinutes() < 10) {
            var myMinutes = '0' + times.getMinutes().toString(); //当前的分钟；
          } else {
            var myMinutes = times.getMinutes(); //当前的分钟；
          }
          // console.log(times)
          return myHours + ':' + myMinutes;
        }),
        (this.FasongShijian = function () {
          //发送时间显示函数
          var timeHour = new Date().getTime();
          if (timeHour - dateTimes < 100000) {
            console.log(timeHour - dateTimes);
            dateTimes = timeHour;
            return;
          }
          dateTimes = timeHour;
          // var contentTexte=this.$refs.contentTexte;
          var shiJian = document.createElement('div');
          var shiJianCont = document.createElement('p');
          shiJianCont.innerHTML = this.ChushiHuaTimes(); //调用初始化时间函数
          shiJian.appendChild(shiJianCont);
          this.prent.appendChild(shiJian);
          shiJian.style.fontSize = 0;
          shiJianCont.style.color = '#fff';
          shiJianCont.style.fontSize = '0.32rem';
          shiJianCont.style.background = '#cfced2';
          shiJianCont.style.display = 'inline-block';
          shiJianCont.style.padding = '0 0.12rem';
          shiJianCont.style.borderRadius = '0.08rem';
          shiJian.style.padding = '0.2rem 0';
          shiJian.style.textAlign = 'center';
          // contentTexte.scrollTop=contentTexte.scrollHeight;  //滚动条始终在下面
        }),
        (this.TishiNeirong = function (texts) {
          //或其他公告提示信息
          var tiShi = document.createElement('div'); //创建DOM元素
          var textCont = document.createElement('font');
          textCont.innerText = texts; //插入提示信息
          tiShi.appendChild(textCont);
          this.prent.appendChild(tiShi);
          textCont.style.color = '#b4b4b4';
          textCont.style.lineHeight = '0.4rem';
          textCont.style.fontSize = '0.32rem';
          textCont.style.wordWrap = 'break-word';
          tiShi.style.width = '82%';
          tiShi.style.fontSize = '0';
          tiShi.style.margin = '0 auto';
          tiShi.style.padding = '0.2rem 0';
          tiShi.style.textAlign = 'center';
        }),
        (this.scrollHeights = function () {
          var dom1 = document.getElementById('contentTexte');
          var el_height = dom1.scrollHeight; //   ===>  获得滚动条的高度
          $('#contentTexte').scrollTop(el_height); //  ===> 设置滚动条的位置，滚动到底部
        }),
        (this.clearNumber = function (
          fromName,
          toName,
          groupChat,
          nickNameTop
        ) {
          console.log(fromName, toName, groupChat, nickNameTop);
          var toName_1 = null;
          if (groupChat) {
            toName_1 = JSON.stringify(toName);
          } else {
            toName_1 = toName;
          }

          // 消息清零
          $.ajax({
            type: 'post',
            url: 'http://127.0.0.1:8080/post6',
            data: {
              fromName: fromName,
              myName: toName_1,
              clear: 'ok',
              type: groupChat,
              nickName: nickNameTop,
            },
            success: function (data) {
              console.log(data);
              if (data.code == 200) {
                // alert(data.msg);
                // getList1('location');
                // window.localStorage.setItem('toChatName',friendName);
              }
            },
            error: function () {
              console.log('error');
            },
          });
        }),
        (this.socketIo = function () {
          //消息监听
          socket.on('message', function (data) {
            if (data.text) {
              if (data.text.fromName == myLocName) {
                console.log('000-', data.text);

                if (data.text.text_last) {
                  return;
                }
                that.FasongShijian();
                if (data.text.text.friends == 'yes') {
                  that.TishiNeirong(
                    '你通过了对方的好友验证请求，现在可以开始聊天啦😄'
                  );
                  //								that.TishiNeirong(data.text.text.text);
                } else if (data.text.text.friend == 'no') {
                  that.TishiNeirong('您向对方发送了好友验证请求，请耐心等待！');
                } else if (data.text.text.friends == 'no') {
                  that.TishiNeirong('您拒绝了对方的好友验证请求！');
                } else {
                  that.My('', data.text.text);
                }
                // that.My('',data.text.text);
                $('#texts')[0].innerText = '';
                $('.fasong').css({ background: 'none' }).find('span').hide();
                $('.fasong font').show();
              } else if (
                data.text.fromName === myLocName &&
                data.text.toName != '' &&
                data.text.toName != myLocName
              ) {
                console.log('111-', data.text);
                that.My('', data.text.text);
              } else if (
                data.text.toName === myLocName &&
                data.text.fromName == window.localStorage.getItem('toChatName')
              ) {
                console.log('222-', data.text);
                that.FasongShijian();
                var settime = setTimeout(function () {
                  that.clearNumber(data.text.fromName, data.text.toName);
                  clearTimeout(settime);
                }, 200);
                if (data.text.text.friends == 'yes') {
                  $('.shuru').show();
                  that.TishiNeirong(data.text.text.text);
                } else if (data.text.text.friend == 'no') {
                  that.You(
                    'yes',
                    '',
                    '😄来自' + data.text.fromName + '的好友验证请求，是否同意！'
                  );
                  $('.shuru').hide();
                  // that.TishiNeirong(data.text.text);
                } else {
                  if (data.text.text.friends == 'no') {
                    that.You(
                      'yes',
                      'no',
                      '🙁对方拒绝了您的好友验证请求！是否再次添加好友...',
                      'no'
                    );
                  } else {
                    that.You('yes', 'yes', data.text.text);
                  }
                }
              } else if (data.text.type == 'groupChat') {
                //群聊数据
                console.log('333-', data);
                if (data.text.text_last) {
                  alert('本群已被移除！');
                  window.location.href = 'liaoTianLieBiao.html';
                  return;
                }
                that.FasongShijian();
                if (data.text.text_first) {
                  that.TishiNeirong(data.text.text);
                } else {
                  //								that.You('yes','yes',data.text.text,data.text.fromName,data.text.text_first);
                  that.You(
                    'yes',
                    'yes',
                    data.text.text,
                    data.text.fromName,
                    data.text.myIconName
                  );
                  var settime = setTimeout(function () {
                    that.clearNumber(
                      myLocName,
                      window.localStorage.getItem('toChatName'),
                      'groupChat',
                      nickNameTop
                    );
                    clearTimeout(settime);
                  }, 200);
                }
              }
              if (data.text.toName === '' && data.text.fromName !== myLocName) {
                console.log('444-', data.text);
                // toDom(data.text.fromName,data.text.text,data.text.dateTime);
              }
              that.scrollHeights();
            }
          });
          //填充对方的对话框
          function toDom(fromName, text, dateTime) {
            // 					var dom = $('#list_test');
            // 					dom.append("<li style='height:36px;text-align:center;width:100%;color:red;'>时间"+dateTime+"</li>");
            // 					dom.append("<li style='height:36px;'>"+fromName+"在公告："+text+"</li>");
            // 					var el_height = dom[0].scrollHeight//   ===>  获得滚动条的高度
            // 					dom.scrollTop(el_height)//  ===> 设置滚动条的位置，滚动到底部
          }
          //发送消息
          $('.fasong span').click(function () {
            var timeHour = new Date().getTime();
            var dateYes = 'no';
            if (timeHour - dateTimes > 100000) {
              console.log(timeHour - dateTimes);
              dateYes = 'yes';
            }
            $('.expressions').attr({ class: 'expressions' });
            $('.expression').hide().removeAttr('show');
            $('#shuru ul').css({ 'padding-top': '0.14rem' });
            $('#box').css({ 'padding-bottom': '1.2rem' });
            heights1 = $('#shuru').height();
            heights = $('#shuru').height();
            function Trim(str) {
              return str.replace(/(^\s*)|(\s*$)/g, '');
            }
            // console.log(Trim($('#texts')[0].innerText))
            $('.expression').hide();
            if (Trim($('#texts')[0].innerText) != '') {
              if (chatType == 'chat') {
                socket.emit('clientmessage', {
                  fromName: myLocName,
                  // toName: $('#texts0')[0].value,
                  toName: window.localStorage.getItem('toChatName'),
                  text: Trim($('#texts')[0].innerText),
                  fromTo: (
                    window.localStorage.getItem('toChatName') * 1 +
                    myLocName * 1
                  ).toString(),
                  dateTimes: dateYes,
                });
              } else {
                //群聊
                var toChatNames = window.localStorage
                    .getItem('toChatName')
                    .split(','),
                  fromChat = null;
                for (var i = 0; i < toChatNames.length; i++) {
                  fromChat += toChatNames[i].name * 1;
                }
                fromChat = nickNameTop + fromChat.toString();
                socket.emit('clientmessage', {
                  fromName: myLocName,
                  // toName: $('#texts0')[0].value,
                  toName: JSON.parse(window.localStorage.getItem('toChatName')),
                  text: Trim($('#texts')[0].innerText),
                  fromTo: fromChat,
                  nickName: nickNameTop,
                  dateTimes: dateYes,
                  myIconName: locMyName,
                });
              }
            }
          });
        }),
        (this.getList = function getList(types) {
          $.ajax({
            type: 'get',
            url: 'http://127.0.0.1:8080/get1',
            data: {
              type: chatType,
              page: page,
              pageSize: pageSize,
              friendName: window.localStorage.getItem('toChatName'),
              myName: myLocName,
              nickName: nickNameTop,
            },
            success: function (data) {
              console.log(data);
              if ((data.code = 200)) {
                var dom0 = $('#list_test');
                var dom1 = $('.content-text');
                var dom;
                var length = data.body.length,
                  yes = '';
                if ($('#list_test').find('li').eq(0).length !== 0) {
                  dom = dom0.find('li').eq(0);
                } else {
                  dom = dom0.find('p');
                }
                console.log(dom);
                dateTimes = data.body[length - 1].dateTime;
                for (var i = 0; i < length; i++) {
                  if (!data.body[length - 1].friend) {
                    yes = 'yes';
                  }
                  // console.log('000',data.body[i]);
                  if (data.body[i].fromName == myLocName) {
                    // console.log('111',data.body[i]);
                    if (data.body[i].type == 'chat') {
                      that.tousuoGo(
                        that.numToTime(data.body[i].dateTime),
                        data.body[i].dateTimes
                      );
                      if (data.body[i].text.friends == 'yes') {
                        $('.shuru').show();
                        that.TishiNeirong(
                          '你已通过对方的好友验证请求，现在可以开始聊天啦😄'
                        );
                        //											that.TishiNeirong(data.body[i].text.text);
                      } else if (data.body[i].text.friend == 'no') {
                        $('.shuru').hide();
                        that.TishiNeirong(
                          '您向对方发送了好友验证请求，请耐心等待！'
                        );
                      } else if (data.body[i].text.friends == 'no') {
                        $('.shuru').hide();
                        that.TishiNeirong('您拒绝了对方的好友验证请求！');
                      } else {
                        that.My('', data.body[i].text);
                      }
                    } else if (chatType == 'groupChat') {
                      that.tousuoGo(
                        that.numToTime(data.body[i].dateTime),
                        data.body[i].dateTimes
                      );
                      if (data.body[i].text_first) {
                        that.TishiNeirong(data.body[i].text);
                      } else {
                        that.My('', data.body[i].text);
                      }
                    }
                  } else if (
                    data.body[i].fromName === myLocName &&
                    data.body[i].toName !== '' &&
                    data.text.toName != myLocName
                  ) {
                    // console.log('222',data.body[i]);
                    that.My('', data.body[i].text);
                  } else if (
                    data.body[i].toName === '' &&
                    data.body[i].fromName === myLocName
                  ) {
                  } else if (
                    data.body[i].toName === '' &&
                    data.body[i].fromName !== myLocName
                  ) {
                    //
                  } else if (data.body[i].toName === myLocName) {
                    // console.log('333',data.body[i]);
                    that.tousuoGo(
                      that.numToTime(data.body[i].dateTime),
                      data.body[i].dateTimes
                    );
                    if (data.body[i].text.friend == 'no') {
                      if (data.body[i].friend == 'yes') {
                        that.You(
                          yes,
                          '',
                          '😄来自' +
                            data.body[i].fromName +
                            '的好友验证请求，是否同意！',
                          1
                        );
                      } else {
                        that.You(
                          yes,
                          '',
                          '😄来自' +
                            data.body[i].fromName +
                            '的好友验证请求，是否同意！'
                        );
                        $('.shuru').hide();
                      }
                    } else {
                      if (data.body[i].text.friends == 'yes') {
                        $('.shuru').show();
                        that.You(yes, 'yes', data.body[i].text.text);
                        //											that.TishiNeirong(data.body[i].text.text);
                      } else if (data.body[i].text.friends == 'no') {
                        $('.shuru').hide();
                        // that.TishiNeirong('对方拒绝了您的好友请求！');
                        that.You(
                          yes,
                          'no',
                          '🙁对方拒绝了您的好友验证请求！是否再次添加好友...',
                          data.body[i].friend
                        );
                      } else {
                        that.You(yes, 'yes', data.body[i].text);
                      }
                    }
                  } else if (data.body[i].type == 'groupChat') {
                    that.tousuoGo(
                      that.numToTime(data.body[i].dateTime),
                      data.body[i].dateTimes
                    );
                    if (data.body[i].text_first) {
                      that.TishiNeirong(data.body[i].text);
                    } else {
                      that.You(
                        yes,
                        'yes',
                        data.body[i].text,
                        data.body[i].fromName,
                        data.body[i].myIconName
                      );
                    }
                  }
                }
                if (types) {
                  dom1.scrollTop(0);
                } else {
                  // 							var el_height = dom0[0].scrollHeight//   ===>  获得滚动条的高度
                  // 							dom0.scrollTop(el_height)//  ===> 设置滚动条的位置，滚动到底部
                }
              }
              page += 1;
            },
            error: function () {
              console.log('error');
            },
          });
        }),
        (this.My = function (type, cont) {
          //我要发送信息处理函数
          // var contentTexte=this.$refs.contentTexte;
          var you = document.createElement('div'); //创建元素        我要发送的dom
          var neiRong = document.createElement('div'); //内容信息
          var touXiang = document.createElement('div'); //头像
          var span = document.createElement('span');
          var imaF = document.createElement('div');
          var img = document.createElement('img');
          var imgs = document.createElement('div');
          you.setAttribute('class', 'fankiu-you'); //添加属性
          neiRong.setAttribute('class', 'fankiu-text clearbox');
          touXiang.setAttribute('class', 'fankiu-img');
          imgs.style.backgroundImage = 'url(' + '"' + this.Youimg + '"' + ')';
          imgs.style.backgroundSize = '100% 100%';
          //				img.setAttribute("class","border");
          //					span.appendChild(imgs);float: left;
          neiRong.appendChild(span);
          neiRong.appendChild(imgs);
          imaF.appendChild(img);
          touXiang.appendChild(imaF);
          you.appendChild(neiRong);
          you.appendChild(touXiang);
          this.prent.appendChild(you);
          you.style.width = '92%'; //样式4
          you.style.margin = '0 auto';
          you.style.textAlign = 'justify';
          you.style.lineHeight = '0.4rem';
          you.style.overflow = 'hidden';
          you.style.padding = '0.1rem 0';
          neiRong.style.width = '86%';
          neiRong.style.float = 'left';
          //					neiRong.style.overflow="hidden";
          neiRong.style.position = 'relative';
          span.style.display = 'inline-block';
          span.style.padding = '0.16rem 0.2rem';
          span.style.background = '#ff7a59';
          span.style.color = '#fff';
          span.style.float = 'right';
          span.style.maxWidth = '77%';
          span.style.borderRadius = '0.08rem';
          span.style.fontSize = '0.32rem';
          span.style.border = '0.01rem solid #e7e6e9';
          span.style.wordWrap = 'break-word';
          touXiang.style.width = '14%';
          touXiang.style.float = 'left';
          touXiang.style.overflow = 'hidden';
          imaF.style.width = '0.76rem';
          imaF.style.height = '0.76rem';
          imaF.style.border = '0.01rem solid #e7e6e9';
          imaF.style.boxSizing = 'border-box';
          imaF.style.float = 'right';
          imaF.style.overflow = 'hidden';
          imaF.style.borderRadius = '0.04rem';
          img.style.background = '#EAEAEA';
          img.style.float = 'right';
          img.style.borderRadius = '0.04rem';
          img.src = Myimg;
          img.style.width = '100%';
          imgs.style.position = 'absolute';
          imgs.style.width = '0.16rem';
          imgs.style.height = '0.22rem';
          imgs.style.top = '0.26rem';
          imgs.style.right = '-0.13rem';
          // 				if(type==1){			//发送的是名片
          // 					span.style.background="#fff";
          // //					imgs.style.background="#fff";
          // 					span.appendChild(this.MingpianTishi(cont));
          // 				}else{
          span.innerHTML = cont; //对应插入
          // this.introduction="";
          // }
          // this.FasongShijian();
          // contentTexte.scrollTop=contentTexte.scrollHeight;  //滚动条始终在下面
        }),
        (this.You = function (
          yes,
          type,
          cont,
          DianJi,
          myIconName,
          remarksNuber
        ) {
          //对方要发送信息处理函数
          // var contentTexte=this.$refs.contentTexte;
          var my = document.createElement('div'); //创建元素		对方要发送的dom
          var neiRong = document.createElement('div');
          var touXiang = document.createElement('div');
          var span = document.createElement('span');
          var imaF = document.createElement('div');
          var img = document.createElement('img');
          var imgs = document.createElement('div');
          var tata = this;
          my.setAttribute('class', 'fankiu-my'); //添加属性
          neiRong.setAttribute('class', 'fankiu-text');
          touXiang.setAttribute('class', 'fankiu-img');
          imgs.style.backgroundImage = 'url(' + '"' + this.Youimg + '"' + ')';
          imgs.style.backgroundSize = '100% 100%';
          //				img.setAttribute("class","border");
          //						span.innerText=texts;							//对应插入
          if (!myIconName) {
            neiRong.appendChild(span);
            neiRong.appendChild(imgs);
          }
          imaF.appendChild(img);
          touXiang.appendChild(imaF);
          my.appendChild(touXiang);
          my.appendChild(neiRong);
          this.prent.appendChild(my);
          my.style.width = '92%'; //样式4
          my.style.margin = '0 auto';
          my.style.lineHeight = '0.4rem';
          my.style.textAlign = 'justify';
          my.style.display = 'flex';
          my.style.padding = '0.1rem 0';
          neiRong.style.width = '86%';
          neiRong.style.position = 'relative';
          // neiRong.style.float="left";
          span.style.display = 'inline-block';
          span.style.padding = '0.16rem 0.2rem';
          span.style.background = '#fff';
          span.style.maxWidth = '77%';
          span.style.borderRadius = '0.08rem';
          span.style.fontSize = '0.32rem';
          span.style.border = '0.01rem solid #e7e6e9';
          span.style.wordWrap = 'break-word';
          span.style.float = 'left';
          touXiang.style.width = '14%';
          touXiang.style.height = '0.76rem';
          //					touXiang.style.float="left";
          imaF.style.width = '0.76rem';
          imaF.style.height = '0.76rem';
          imaF.style.border = '0.01rem solid #e7e6e9';
          imaF.style.boxSizing = 'border-box';
          imaF.style.overflow = 'hidden';
          imaF.style.borderRadius = '0.04rem';
          imaF.onclick = function () {
            //				对方个人资料
            if (yes) {
              if (DianJi) {
                console.log(DianJi);
                var imglist = JSON.parse(
                  window.localStorage.getItem('imgIdLoc')
                );
                for (var i = 0; i < imglist.length; i++) {
                  if (imglist[i].name == DianJi) {
                    window.localStorage.setItem(
                      'headPortrait_groupChat',
                      imglist[i].classIcon
                    );
                    window.localStorage.setItem('toChatName_groupChat', DianJi);
                    break;
                  }
                }
              }
              console.log(
                '对方个人资料',
                yes,
                type,
                cont,
                DianJi,
                myIconName,
                remarksNuber
              );
              window.location.href = 'ziLiaoXiangQing.html';
            }
          };
          //				img.style.width="0.38rem";
          //				img.style.height="0.38rem";
          img.style.background = '#EAEAEA';
          img.style.borderRadius = '0.04rem';
          img.style.float = 'left';
          img.src = Youimg;
          img.style.width = '100%';
          imgs.style.position = 'absolute';
          //				imgs.style.background="#fff";
          imgs.style.width = '0.16rem';
          imgs.style.height = '0.22rem';
          //				imgs.style.borderLeft="0.008rem solid #d4d2d2";
          //				imgs.style.borderTop="0.008rem solid #d4d2d2";
          //				imgs.style.transform="rotate(-45deg)";
          imgs.style.top = '0.26rem';
          imgs.style.left = '-0.13rem';
          imgs.style.Zindex = 100;
          if (type == 'yes') {
            if (DianJi) {
              console.log(DianJi);
              var imglist = JSON.parse(window.localStorage.getItem('imgIdLoc'));
              for (var i = 0; i < imglist.length; i++) {
                if (imglist[i].name == DianJi) {
                  img.src = imglist[i].classIcon;
                  break;
                }
              }
              var from_name = document.createElement('div');
              from_name.style.fontSize = '0.26rem';
              from_name.style.color = '#07111B';
              from_name.style.lineHeight = '0.2rem';
              from_name.style.padding = '0 0 0.1rem 0.1rem';
              from_name.style.color = 'rgb(180, 180, 180)';
              from_name.innerHTML = myIconName;
              neiRong.appendChild(from_name);
              neiRong.appendChild(span);
              neiRong.appendChild(imgs);
              span.innerHTML = cont; //对应插入
            } else {
              span.innerHTML = cont; //对应插入
            }
          } else {
            span.appendChild(this.HuanquSenqing(cont, DianJi, type));
          }
        }),
        //			投诉调用
        (this.BugenYuanyin = function (texts) {
          var farams = {
            //发送评论接口
            token: this.Token,
            //					to_id:this.uid,					//对方id	是	[string]
            terminalNo: '3',
            rid: this.uid,
            content: texts,
            ctype: 6, //举报原因id
            //					ctype: this.selectedID		//举报原因id
          };
          //				console.log(farams)
          Indicator.open({ spinnerType: 'fading-circle' });
          this.$http
            .post(URL.path1 + 'account/report', farams, { emulateJSON: true })
            .then(
              function (res) {
                Indicator.close();
                //					Toast("提交后我们将在24小时内处理")
                Toast('投诉成功');
                this.onlyContent = false;
                this.onlyContent1 = false;
                //					console.log(res);
              },
              function (res) {
                Indicator.close();
                Toast(data.msg);
                console.log(res);
              }
            );
        }),
        (this.HuanquSenqing = function (cont, DianJi, type) {
          //换名片和发送项目申请提示处理函数
          var mingPian = document.createElement('div'); //换名片申请提示	  是否确定换名片  创建DOM元素    在对方对话框内显示
          var mingText = document.createElement('p');
          var mingSpan = document.createElement('span');
          var mingFont = document.createElement('font');
          var locFromName = window.localStorage.getItem('fromName'),
            myName = window.localStorage.getItem('name');
          if (type == 'no') {
            mingSpan.innerText = '是';
            mingFont.innerText = '否';
          } else {
            mingSpan.innerText = '同意';
            mingFont.innerText = '拒绝';
          }
          mingText.innerText = cont; //后台获取信息插入

          mingPian.appendChild(mingText);
          mingPian.appendChild(mingSpan);
          mingPian.appendChild(mingFont);
          // that.prent.appendChild(mingPian);						//最终要插入到对话框内
          mingPian.style.width = '4.04rem';
          mingPian.style.margin = '0 auto';
          mingPian.style.minHeight = '1.26rem';
          mingPian.style.position = 'relative';
          mingPian.style.background = '#fff';
          // mingPian.style.padding="0.16rem 0.2rem";
          mingText.style.lineHeight = '0.42rem';
          mingText.style.fontSize = '0.32rem';
          mingText.style.wordWrap = 'break-word';
          mingText.style.padding = '0 0 0.72rem 0';
          mingText.style.color = '#07111B';
          mingSpan.style.position = 'absolute';
          mingSpan.style.fontSize = '0.32rem';
          mingSpan.style.display = 'inline-block';
          mingSpan.style.left = '0';
          mingSpan.style.bottom = '0';
          mingSpan.style.color = '#f5f4f9';
          mingSpan.style.width = '46%';
          mingSpan.style.height = '0.62rem';
          mingSpan.style.borderRadius = '0.08rem';
          mingSpan.style.background = '#ff7a59';
          mingSpan.style.lineHeight = '0.62rem';
          mingSpan.style.textAlign = 'center';
          var i = 0;
          if (DianJi == 1 || DianJi == 'yes') {
            i = 1;
            mingSpan.style.color = '#000000';
            mingSpan.style.background = '#f5f4f9';
          }
          mingSpan.onclick = function () {
            //添加好友同意事件
            var timeHour = new Date().getTime();
            var dateYes = 'no';
            if (timeHour - dateTimes > 100000) {
              // console.log(timeHour - dateTimes);
              dateYes = 'yes';
            }
            if (i == 1) {
              return;
            }
            i++;
            console.log(i);
            if (type == 'no') {
              var name = window.localStorage.getItem('name'),
                addName = window.localStorage.getItem('toChatName'),
                nickName = window.localStorage.getItem('toNames');
              //添加好友；
              $.ajax({
                type: 'post',
                url: 'http://127.0.0.1:8080/post4',
                data: {
                  addName: nickName,
                  fromNumber: name,
                  addNumber: addName,
                  addFriend: 2,
                },
                success: function (data) {
                  console.log(data);
                  if (data.code == 200) {
                    mingSpan.style.color = '#000000';
                    mingSpan.style.background = '#f5f4f9';
                    //向对方发送添加好友验证消息
                    socket.emit('clientmessage', {
                      fromName: name,
                      toName: addName,
                      text: { friend: 'no', addName: nickName, addFriend: 2 },
                      dateTimes: dateYes,
                    });
                    alert(data.msg);
                  } else {
                    alert(data.msg);
                  }
                },
                error: function () {
                  console.log('error');
                },
              });
            } else {
              //添加好友同意请求
              $.ajax({
                type: 'post',
                url: 'http://127.0.0.1:8080/post5',
                data: { fromName: locFromName, myName: myName, friends: 'yes' },
                success: function (data) {
                  console.log(data);
                  if (data.code == 200) {
                    alert(data.msg);
                    $('.shuru').show();
                    mingSpan.style.color = '#000000';
                    mingSpan.style.background = '#f5f4f9';
                    //向对方发送添加好友验证消息
                    socket.emit('clientmessage', {
                      fromName: myName,
                      toName: locFromName,
                      text: {
                        from: myName,
                        text: '我通过了你的好友验证请求，我们现在可以聊天啦！😄',
                        friends: 'yes',
                      },
                      dateTimes: dateYes,
                    });
                  }
                },
                error: function () {
                  console.log('error');
                },
              });
            }
          };
          mingFont.style.position = 'absolute';
          mingFont.style.fontSize = '0.32rem';
          mingFont.style.right = '0';
          mingFont.style.bottom = '0';
          mingFont.style.width = '46%';
          mingFont.style.height = '0.62rem';
          mingFont.style.borderRadius = '0.08rem';
          mingFont.style.background = '#f5f4f9';
          mingFont.style.lineHeight = '0.62rem';
          mingFont.style.textAlign = 'center';

          mingFont.onclick = function () {
            //绑定好友拒绝事件
            if (type == 'no') {
              return;
            }
            var timeHour = new Date().getTime();
            var dateYes = 'no';
            if (timeHour - dateTimes > 100000) {
              // console.log(timeHour - dateTimes);
              dateYes = 'yes';
            }
            if (DianJi == 1) {
              return;
            }
            if (i == 1) {
              return;
            }
            i++;
            //好友拒绝请求
            $.ajax({
              type: 'post',
              url: 'http://127.0.0.1:8080/post5',
              data: { fromName: locFromName, myName: myName, friends: 'no' },
              success: function (data) {
                console.log(data);
                if (data.code == 200) {
                  // alert(data.msg);
                  mingSpan.style.color = '#000000';
                  mingSpan.style.background = '#f5f4f9';
                  //向对方发送添加好友验证消息
                  socket.emit('clientmessage', {
                    fromName: myName,
                    toName: locFromName,
                    text: {
                      from: myName,
                      text: '您拒绝了对方的好友验证请求！',
                      friends: 'no',
                    },
                    dateTimes: dateYes,
                  });
                }
              },
              error: function () {
                console.log('error');
              },
            });
          };
          return mingPian;
        }),
        (this.MingpianTishi = function (cont, name, pont) {
          //申请换名片处理函数
          var mingPianTishi = document.createElement('div'); //申请换名片提示   创建DOM元素
          var NameTishi = document.createElement('p');
          var SpanTishi = document.createElement('span');
          var FontTishi = document.createElement('font');
          var GerenTishi = document.createElement('p');
          SpanTishi.innerText = cont['uname']; //后台获取信息插入
          FontTishi.innerText = cont['phone']; //后台获取信息插入
          GerenTishi.innerText = '个人名片';
          NameTishi.appendChild(SpanTishi);
          NameTishi.appendChild(FontTishi);
          mingPianTishi.appendChild(NameTishi);
          mingPianTishi.appendChild(GerenTishi);
          //						thata.prent.appendChild(mingPianTishi);						//最终要插入到对话框内
          mingPianTishi.style.width = '2.02rem';
          mingPianTishi.style.margin = '0 auto';
          mingPianTishi.style.minHeight = '0.56rem';
          mingPianTishi.style.fontSize = '0.16rem';
          mingPianTishi.style.background = '#fff';
          NameTishi.style.lineHeight = '0.34rem';
          NameTishi.style.height = '0.4rem';
          NameTishi.style.color = '#07111B';
          SpanTishi.style.display = 'inline-block';
          SpanTishi.style.padding = '0 0.07rem 0 0';
          GerenTishi.style.borderTop = '1px solid #cfcfcf';
          GerenTishi.style.fontSize = '0.13rem';
          GerenTishi.style.padding = '0.06rem 0 0 0.03rem';
          GerenTishi.style.color = '#b4b4b4';
          mingPianTishi.onclick = function () {
            //提示添加通讯录弹框
            that.$refs.tishiShow.tishiBlock(that.tongxun, FontTishi.innerText); //CanShu是下级要传的参数
          };
          return mingPianTishi;
        });
    }
    var that = new Default();
    that.props();
  </script>
</html>
